<html>
    <head>
        {% load static %}
        <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}"/>
        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.css">
        <script
            src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
            crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.jss"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.bundle.min.js"></script>
    </head>

    <body>
        <div class="ui grid padded ">
            <div class="sixteen wide column">
                <div class="ui segment centered padded">
                    <div class="card">
                      <div class="content">
                        <h2 class="ui center aligned icon header">
                            <i class="circular audio description icon"></i>
                            Transcript
                        </h2>
                        <div class="meta ui huge header centered red">
                            {{new_file_name}}
                        </div>
                        <div class="description ui large header centered">
                            {{transcript}}
                        </div>
                        <div class="description ui small header centered">
                            {{phoneme}}
                        </div>
                      </div>
                      <div class="content center">
                        <div style="display: flex; justify-content: space-around; margin-top: 30px;">
                            <form action="{% url 'record' %}" method="POST">
                                {% csrf_token %}
                                <div class="ui left action input">
                                    <button class="ui green labeled icon button" id="submit" type="submit">
                                      <i class="play circle icon"></i>
                                      Record
                                    </button>
                                    <input type="text" value={{new_file_name}} >
                                </div>
                            </form>
                            <form action="{% url 'stopRecord' %}" method="POST">
                                {% csrf_token %}
                                <button id="submit" type="submit" value="Stop Record" class="ui red labeled icon button">
                                    <i class="stop circle outline icon"></i>
                                    Stop Record
                                </button>
                            </form>
                        </div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="four wide column">
                <div class="ui list">
                    <table class="ui very basic collapsing celled table">
                        <thead>
                            <tr>
                                <h2 class="ui header">
                                    <i class="folder outline icon"></i>
                                    <div class="content">
                                        File names
                                    </div>
                                </h2>
                            </tr>
                        </thead>
                        <tbody>
                            {% for file in list_of_files %}
                                <tr>
                                    <td>
                                        <h4 class="ui image header">
                                            <i class="file audio outline icon"></i>
                                            <div class="content">
                                                {{file}}
                                            </div>
                                        </h4>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="twelve wide column">
                <div id="demo">
                    {{start}}
                    <canvas id="myChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>

        <script>
            function getChartData() {
                $.ajax({
                    url: "http://localhost:8000/sensorContent/{{new_file_name}}",
                    success: function (result) {
                        console.log(result)
                        if(result) renderChart(result);
                    }
                });
            }

            function renderChart(data) {
                var ctx = document.getElementById("myChart").getContext('2d');
                var myChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                        datasets: [
                            {
                                label: 'Left',
                                data: data[0],
                                borderColor: 'rgba(75, 192, 192, 1)',
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            },
                            {
                                label: 'Top',
                                data: data[1],
                                borderColor: 'rgba(192, 192, 192, 1)',
                                backgroundColor: 'rgba(192, 192, 192, 0.2)',
                            }
                        ]
                    },
                });
            }

            if ("{{record}}" == "True") setInterval(getChartData, 500);
        </script>
    </body>
</html>